name: Sync Phylo to ATProto

on:
  workflow_dispatch:
    inputs:
      ott_id:
        description: 'OTT ID of root taxon (913935=Primates, 244265=Mammalia, 795941=Cephalopoda)'
        required: true
        default: '913935'
      height_limit:
        description: 'OToL API height limit (-1=unlimited, use 5-10 for large clades)'
        required: false
        default: '-1'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Sync OToL subtree to ATProto PDS
        env:
          BLUESKY_HANDLE: ${{ secrets.BLUESKY_HANDLE }}
          BLUESKY_APP_PASSWORD: ${{ secrets.BLUESKY_APP_PASSWORD }}
        run: |
          python3 scripts/sync-otol-to-atproto.py \
            --ott-id ${{ inputs.ott_id || '913935' }} \
            --height-limit ${{ inputs.height_limit || '-1' }}
